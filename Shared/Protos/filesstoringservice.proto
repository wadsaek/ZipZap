syntax = "proto3";

option csharp_namespace = "ZipZap.Grpc";

import "guid.proto";
import "fsotypes.proto";
import "emptyrequest.proto";
import "pathdata.proto";
import "user.proto";

message SaveFileRequest {
  PathData path = 1;
  bytes content = 2;
}
message MakeLinkRequest {
  PathData path = 1;
  string target = 2;
}
message MakeDirectoryRequest {
  PathData path = 1;
}
message SaveFileResponse{
  Guid fileId = 1;
}

message GetFsoRequest{
  oneof identifier {
    Guid fsoId = 1;
    PathData path = 2;
  }
}

message GetFsoResponse{
  Guid fsoId = 5;
  FsoSharedData data = 1;
  oneof specificData {
    FileData fileData = 2;
    DirectoryData directoryData = 3;
    SymlinkData symlinkData = 4;
  }
}

message GetRootRequest {
}
message GetRootResponse {
  Guid fsoId = 3;
  FsoSharedData data = 1;
  DirectoryData directoryData = 2;
}

message DeleteFsoRequest{
  Guid fsoId = 1;
}

message ReplaceFileRequest{
  oneof identifier {
    Guid fsoId = 1;
    PathData path = 2;
  }
  bytes content = 3;
}

message ExistsOwnerIdRequest{
  string ownerId = 1;
}

message ExistsOwnerIdResponse{
  bool exists = 1;
}

message LoginRequest {
  string username = 1;
  string password = 2;
}
message LoginResponse {
  string token = 1;
}

service FilesStoringService {
  rpc SaveFile(SaveFileRequest) returns (SaveFileResponse);
  rpc MakeDirectory(MakeDirectoryRequest) returns (SaveFileResponse);
  rpc MakeLink(MakeLinkRequest) returns (SaveFileResponse);
  rpc GetFso(GetFsoRequest) returns (GetFsoResponse);
  rpc GetRoot(EmptyMessage) returns (GetRootResponse);
  rpc DeleteFso(DeleteFsoRequest) returns (EmptyMessage);
  rpc RemoveFrenchLanguagePack(EmptyMessage) returns (EmptyMessage);
  rpc ReplaceFile(ReplaceFileRequest) returns (EmptyMessage);

  rpc Login(LoginRequest) returns (LoginResponse);
  rpc GetSelf(EmptyMessage) returns (User);
}
