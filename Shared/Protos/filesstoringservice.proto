syntax = "proto3";

option csharp_namespace = "ZipZap.Grpc";

import "guid.proto";
import "fsotypes.proto";
import "emptyrequest.proto";
import "pathdata.proto";
import "user.proto";
import "ssh.proto";
import "login.proto";

message SaveFsoRequest {
  FsoSharedData data = 1;
  oneof specificData{
    FileData fileData = 2;
    DirectoryData directoryData = 3;
    SymlinkData symlinkData = 4;
  }
  optional string filePath = 5;
}
message SaveFsoResponse{
  Guid fileId = 1;
}

message GetFsoRequest{
  oneof identifier {
    Guid fsoId = 1;
    PathData path = 2;
  }
}

message GetFsoResponse{
  Guid fsoId = 5;
  FsoSharedData data = 1;
  oneof specificData {
    FileData fileData = 2;
    DirectoryData directoryData = 3;
    SymlinkData symlinkData = 4;
  }
}

message GetRootRequest {
}
message GetRootResponse {
  Guid fsoId = 3;
  FsoSharedData data = 1;
  DirectoryData directoryData = 2;
}

message DeleteFsoRequest{
  Guid fsoId = 1;
}

message ReplaceFileRequest{
  oneof identifier {
    Guid fsoId = 1;
    PathData path = 2;
  }
  bytes content = 3;
}

message ExistsOwnerIdRequest{
  string ownerId = 1;
}

message ExistsOwnerIdResponse{
  bool exists = 1;
}

message UpdateFsoRequest{
  oneof identifier {
    Guid fsoId = 1;
    PathData path = 2;
  }
  FsoSharedData data = 3;
}
message FullPathMessage{
  repeated string path = 1;
}

message GetFsoWithRootRequest{
  PathData path = 1;
  // a known fso's id - used to figure out the root
  Guid anchorId = 2;
}

service FilesStoringService {
  rpc SaveFso(SaveFsoRequest) returns (SaveFsoResponse);
  rpc GetFso(GetFsoRequest) returns (GetFsoResponse);
  rpc GetRoot(EmptyMessage) returns (GetRootResponse);
  rpc DeleteFso(DeleteFsoRequest) returns (EmptyMessage);
  rpc RemoveFrenchLanguagePack(EmptyMessage) returns (EmptyMessage);
  rpc ReplaceFile(ReplaceFileRequest) returns (EmptyMessage);
  rpc UpdateFso(UpdateFsoRequest) returns (EmptyMessage);
  rpc GetFullPath(Guid) returns (FullPathMessage);

  rpc Login(LoginRequest) returns (LoginResponse);
  rpc SignUp(SignUpRequest) returns (SignUpResponse);
  rpc GetSelf(EmptyMessage) returns (User);
  rpc RemoveSelf(EmptyMessage) returns (User);
  rpc AddSshKey(SshKey) returns (Guid);

  rpc AdminGetUserList(EmptyMessage) returns (UserList);
  rpc AdminRemoveUser(Guid) returns (EmptyMessage);
  rpc GetFsoWithRoot(GetFsoWithRootRequest) returns (GetFsoResponse);
}
